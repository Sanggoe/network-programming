# 네트워크 프로그래밍 프로젝트

<br/>

### 주제 **:** 강의 플랫폼 채팅 프로그램

* 학생들이 강의 수강을 위해 줌, 구글 행아웃, 구글 클래스룸 등 여러 플랫폼들을 사용한다. 개인적으로 비공개로 채팅을 보내 질문을 할 수도 있고, 모두에게 공개적으로 채팅을 보낼 수도 있으며, 강사님께서 공지사항을 올려놓기도 한다. 여기서 아이디어를 얻어, 주제를 선정해보게 되었다.
* 우리가 수업 시간을 통해, 여러 클라이언트에 대한 처리를 해주는 간단한 서버 – 클라이언트 채팅에 대한 개념을 배웠다. 이를 좀 더 응용하여서, 좀 더 구체적인 구현을 통해 실제 채팅 프로그램이 더 가까운 기능들을 추가하여 완성도 있는 프로그램을 구현해보고자 한다.

<br/>

<br/>

### 구현 목표 기능

> 구체적으로 구현하려는 기능에 대한 제안은 다음과 같다.

* **기본 채팅 기능**
  * 모든 참가자는 기본적으로 모두에게 채팅을 보낼 수 있다. 가장 기본 기능이며, 자기가 보낸 메시지를 자신이 다시 수신하지는 않는다.
* **채팅방 방장 설정 기능**
  * 데이터베이스나 다른 기술들을 응용한 프로젝트가 아닌, 소켓 통신의 응용에 집중하기 위한 프로그램이므로, 입장 시 어떤 참가자가 방장이냐에 대한 구분은 최초 입장 시 준 이름과 미리 서버에 저장된 id가 같은 경우 방장 권한을 주는 방법으로 구상했다.
* **채팅방 공지사항 등록 및 삭제 기능**
  * 방장은 서버에 요청해서 공지사항을 등록할 수 있으며, 등록하는 순간 모든 참가자에게 메시지로 전달되고, 채팅방에 참가자가 최초로 들어올 때마다 공지사항들이 처음 들어온 참가자에게 전달된다.
* **공지사항 목록 요청 기능**
  * 모든 참가자는 현재 공지사항 목록을 서버에 요청하여 받을 수 있다.
* **참가자 추방 권한 기능**
  * 방장은 서버에게 요청해서, 참여한 특정 참가자를 추방할 수 있다. 이는 방장의 고유 권한이며, 다른 참가자는 이 기능이 적용되지 않는다.
* **참가자 목록 요청 기능**
  * 모든 참가자는 현재 참가자 목록을 서버에 요청하여 받을 수 있다.
* **귓속말 기능**
  * 모든 참가자는 특정 참가자에게만 채팅을 보낼 수도 있다. (또는, 질문사항에 대해 다른 참가자가 아닌 오직 강사(방장)에게만 비공개 채팅을 보내는 방법으로 구현할 수도 있다.)

<br/>

### 기존 채팅 프로그램

#### 서버

* ip주소는 실행하는 프로그램에서 INADDR_ANY로 입력
* port는 명령행 인자로 입력
* 클라이언트 소켓 리스트를 관리
  * 새 클라이언트 추가 시, 생성 받은 소켓 추가
* 메시지 수신 시 모두에게 전송
  * 발신자에게는 전송하지 않음

#### 추가 기능

* 메시지 수신 시, 먼저 검사하는 기능 추가
  * /a# 참가자이름 : 클라이언트 정보 서버 저장 위해 최초로 보낸 메시지
  * /p# 참가자이름 메시지 : 특정 참가자에게만 비공개 메시지 보내기
  * /?# : 서버에게 공지사항 목록 요청하기
  * /m# : 서버에게 참가자 목록 요청하기
  * /n+# 메시지 : 공지사항 추가하기 (방장기능)
  * /n-# 숫자 : 공지사항 삭제하기 (방장기능)
  * /k# 참가자이름 공백 : 특정 참가자 강퇴하기 (방장기능)
* 방장인지 체크하는 기능 추가

```c
//--------------------------------------------------------------------
// 파일명 : projserv.c
// 기  능 : 1. 참가자 접속 및 목록 관리
//              * 접속 시 모두에게 접속 알림
//              * 접속 시 참가자에게 공지사항 전달
//              * 탈퇴 시 모두에게 탈퇴 알림
//          2. 메시지 수신 및 전달
//              * 명령어인지 검사
//                  2-1. 특정 인원에게 전달
//                      * 존재하는 사용자인지 검사
//                          1) 전달
//                          2) 거부 메시지 전달
//                  2-2. 특정 인원 강퇴
//                      * 방장인지 검사
//                          1) 방장이면 수행후 모두에게 메시지 전달
//                          2) 아니면 거부메시지 전달
//                  2-3. 공지사항 등록
//                      * 방장인지 검사
//                          1) 방장이면 수행후 모두에게 메시지 전달
//                          2) 아니면 거부 메시지 전달
//                  2-4. 현재 접속자 목록
//                      * 요청자에게 전달
//                  2-5. 공지사항 목록
//                      * 요청자에게 전달
//              * 아니면 모두에게 메시지 전달
// 컴파일 : cc -o projserv projserv.c
// 사용법 : projserv 8008
// 모  드 : poling 방식으로 구현
//--------------------------------------------------------------------
```

<br/>

#### 클라이언트

* 서버의 ip 주소, port번호, 실행 시킬 닉네임을 명령행 인자로
* 입력 fd(0)에 I/O 변화 시, 이름이 추가된 버퍼에 메시지를 입력 받아 서버에 송신
* 수신용 소켓에 I/O 변화 시, 수신한 메시지 그대로 출력

#### 추가

```c
//----------------------------------------------------------------------
// 파일명 : projcli.c
// 기  능 : 1. 서버에 접속해 키보드 입력을 서버로 전달
//          2. 서버로부터 오는 메시지를 화면에 출력
//          3. 현재 접속자 목록 요청
//          4. 공지사항 목록 요청
//          4. 특정 아이디에 메시지 전달
//          5. 방장인 경우
//              5-1. 특정 아이디를 강퇴시키라는 메시지 전달
//              5-2. 방장인 경우, 공지사항 추가
// 컴파일 : cc -o projcli projcli.c
// 사용법 : ./projcli 127.0.0.1 8008 name
// 모  드 : selecting 방식
//----------------------------------------------------------------------
```

